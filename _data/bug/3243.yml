+p_xml: 'version="1.0" encoding="UTF-8" standalone="yes" '
+directive: DOCTYPE bugzilla SYSTEM "http://bugzilla.fieldtriptoolbox.org/page.cgi?id=bugzilla.dtd"
bugzilla:
  +@version: 4.4.1
  +@urlbase: http://bugzilla.fieldtriptoolbox.org/
  +@maintainer: r.oostenveld@donders.ru.nl
  bug:
    bug_id: "3243"
    creation_ts: 2017-02-06 17:18:00 +0100
    short_desc: cannot compile "peer" code using Makefile on OSX
    delta_ts: 2019-08-10 12:41:40 +0200
    reporter_accessible: "1"
    cclist_accessible: "1"
    classification_id: "1"
    classification: Unclassified
    product: FieldTrip
    component: peer
    version: unspecified
    rep_platform: PC
    op_sys: Mac OS
    bug_status: CLOSED
    resolution: WONTFIX
    bug_file_loc:
    status_whiteboard:
    keywords:
    priority: P5
    bug_severity: normal
    target_milestone: '---'
    everconfirmed: "1"
    reporter:
      +content: n.n.oosterhof
      +@name: nno
    assigned_to:
      +content: r.oostenveld
      +@name: Robert Oostenveld
    comment_sort_order: oldest_to_newest
    long_desc:
      - +@isprivate: "0"
        commentid: "18363"
        comment_count: "0"
        who:
          +content: n.n.oosterhof
          +@name: nno
        bug_when: 2017-02-06 17:18:21 +0100
        thetext: "Compiling the \"peer\" code using Matlab 2015a on OSX 10.12 gives an error when using the Makefile in src/peer; output below. A google query for \n\n    Undefined symbols for architecture x86_64: \"_mxDeserialize\", referenced from:\n\ndid not return any results. \n\nAny suggestions what could be the issue?\n\nMacBook-Pro-3:src nick$ cd src/peer\nMacBook-Pro-3:src nick$ make\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -L. -L/Applications/MATLAB_R2015a.app/bin/maci64 -leng -lmx -L/Applications/MATLAB_R2015a.app/bin/maci64 -leng -lmx -o ../bin/peerslave.maci64 peerslave.o libpeer.a -lm -lpthread -lpeer\nclang: warning: argument unused during compilation: '-pthread'\nUndefined symbols for architecture x86_64:\n  \"_mxDeserialize\", referenced from:\n      _main in peerslave.o\n  \"_mxSerialize\", referenced from:\n      _main in peerslave.o\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: *** [peerslave.maci64] Error 1\nMacBook-Pro-3:src nick$ make clean\nrm -f core *.o *.obj *.a *~\nMacBook-Pro-3:src nick$ make clean; make\nrm -f core *.o *.obj *.a *~\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c tcpserver.c\ntcpserver.c:204:58: warning: invalid conversion specifier '\n' [-Wformat-invalid-specifier]\n  ...DEBUG(LOG_DEBUG, \"tcpserver: started on port %d, id = %\\n\", host->por...\n                                                           ~^\n./peer.h:88:77: note: expanded from macro 'DEBUG'\n  ...format, ...)       {if (level<=syslog_level) fprintf(stderr, format\"\\...\n                                                                  ^\ntcpserver.c:274:50: warning: cast to 'void *' from smaller integer type 'int'\n      [-Wint-to-void-pointer-cast]\n  ...rc = pthread_create(&tid, NULL, tcpsocket, (void *)c);\n                                                ^\n2 warnings generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c udsserver.c\nudsserver.c:188:50: warning: cast to 'void *' from smaller integer type 'int'\n      [-Wint-to-void-pointer-cast]\n  ...rc = pthread_create(&tid, NULL, tcpsocket, (void *)c);\n                                                ^\n1 warning generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c tcpsocket.c\ntcpsocket.c:72:23: warning: incompatible pointer types assigning to 'void **'\n      from 'message_t **' [-Wincompatible-pointer-types]\n                threadlocal.message = &message;\n                                    ^ ~~~~~~~~\ntcpsocket.c:127:85: warning: format specifies type 'int' but the argument has\n      type 'unsigned long' [-Wformat]\n  ...could not write handshake, n = %d, should be %d\", n, sizeof(int));\n                                                  ~~      ^~~~~~~~~~~\n                                                  %lu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\ntcpsocket.c:144:68: warning: format specifies type 'int' but the argument has\n      type 'unsigned long' [-Wformat]\n  ...\"tcpsocket: read size = %d, should be %d\", n, sizeof(hostdef_t));\n                                           ~~      ^~~~~~~~~~~~~~~~~\n                                           %lu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\ntcpsocket.c:167:85: warning: format specifies type 'int' but the argument has\n      type 'unsigned long' [-Wformat]\n  ...could not write handshake, n = %d, should be %d\", n, sizeof(int));\n                                                  ~~      ^~~~~~~~~~~\n                                                  %lu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\ntcpsocket.c:178:68: warning: format specifies type 'int' but the argument has\n      type 'unsigned long' [-Wformat]\n  ...\"tcpsocket: packet size = %d, should be %d\", n, sizeof(jobdef_t));\n                                             ~~      ^~~~~~~~~~~~~~~~\n                                             %lu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\ntcpsocket.c:230:85: warning: format specifies type 'int' but the argument has\n      type 'unsigned long' [-Wformat]\n  ...could not write handshake, n = %d, should be %d\", n, sizeof(int));\n                                                  ~~      ^~~~~~~~~~~\n                                                  %lu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\ntcpsocket.c:251:85: warning: format specifies type 'int' but the argument has\n      type 'unsigned long' [-Wformat]\n  ...could not write handshake, n = %d, should be %d\", n, sizeof(int));\n                                                  ~~      ^~~~~~~~~~~\n                                                  %lu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\ntcpsocket.c:272:85: warning: format specifies type 'int' but the argument has\n      type 'unsigned long' [-Wformat]\n  ...could not write handshake, n = %d, should be %d\", n, sizeof(int));\n                                                  ~~      ^~~~~~~~~~~\n                                                  %lu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\n8 warnings generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c discover.c\ndiscover.c:105:25: warning: incompatible pointer types assigning to 'void **'\n      from 'hostdef_t **' [-Wincompatible-pointer-types]\n                threadlocal.discovery = &discovery;\n                                      ^ ~~~~~~~~~~\ndiscover.c:217:96: warning: data argument not used by format string\n      [-Wformat-extra-args]\n  ...DEBUG(LOG_DEBUG, \"discover: rejecting %s:%u, id = lu\", discovery->name, discovery->port, discovery->id);\n     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...{if (level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                               ~~~~~~~~~~     ^\ndiscover.c:91:7: warning: unused variable 'i' [-Wunused-variable]\n                int i = 0;\n                    ^\n3 warnings generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c announce.c\nannounce.c:85:23: warning: incompatible pointer types assigning to 'void **'\n      from 'hostdef_t **' [-Wincompatible-pointer-types]\n                threadlocal.message = &message;\n                                    ^ ~~~~~~~~\n1 warning generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c expire.c\nexpire.c:184:24: warning: equality comparison result unused\n      [-Wunused-comparison]\n                                                watchdog.evidence==0;\n                                                ~~~~~~~~~~~~~~~~~^~~\nexpire.c:184:24: note: use '=' to turn this equality comparison into an\n      assignment\n                                                watchdog.evidence==0;\n                                                                 ^~\n                                                                 =\n1 warning generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c util.c\nutil.c:307:33: warning: implicit declaration of function 'mach_task_self' is\n      invalid in C99 [-Wimplicit-function-declaration]\n                if (KERN_SUCCESS != task_info(mach_task_self(), TASK_...\n                                              ^\nutil.c:304:10: warning: unused variable 'task' [-Wunused-variable]\n                task_t task = MACH_PORT_NULL;\n                       ^\n2 warnings generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c extern.c\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c peerinit.c\npeerinit.c:33:12: warning: using the result of an assignment as a condition\n      without parentheses [-Wparentheses]\n                while (c = (*str++))\n                       ~~^~~~~~~~~~\npeerinit.c:33:12: note: place parentheses around the assignment to silence\n      this warning\n                while (c = (*str++))\n                         ^\n                       (           )\npeerinit.c:33:12: note: use '==' to turn this assignment into an equality\n      comparison\n                while (c = (*str++))\n                         ^\n                         ==\npeerinit.c:127:20: warning: passing 'char [128]' to parameter of type\n      'unsigned char *' converts between pointers to integer types with\n      different sign [-Wpointer-sign]\n                host->id += hash(host->name);\n                                 ^~~~~~~~~~\npeerinit.c:28:35: note: passing argument to parameter 'str' here\nunsigned long hash(unsigned char *str)\n                                  ^\npeerinit.c:128:20: warning: passing 'char [128]' to parameter of type\n      'unsigned char *' converts between pointers to integer types with\n      different sign [-Wpointer-sign]\n                host->id += hash(host->user);\n                                 ^~~~~~~~~~\npeerinit.c:28:35: note: passing argument to parameter 'str' here\nunsigned long hash(unsigned char *str)\n                                  ^\npeerinit.c:129:20: warning: passing 'char [128]' to parameter of type\n      'unsigned char *' converts between pointers to integer types with\n      different sign [-Wpointer-sign]\n                host->id += hash(host->group);\n                                 ^~~~~~~~~~~\npeerinit.c:28:35: note: passing argument to parameter 'str' here\nunsigned long hash(unsigned char *str)\n                                  ^\npeerinit.c:130:20: warning: passing 'char [128]' to parameter of type\n      'unsigned char *' converts between pointers to integer types with\n      different sign [-Wpointer-sign]\n                host->id += hash(host->socket);\n                                 ^~~~~~~~~~~~\npeerinit.c:28:35: note: passing argument to parameter 'str' here\nunsigned long hash(unsigned char *str)\n                                  ^\npeerinit.c:134:72: warning: format specifies type 'unsigned long' but the\n      argument has type 'UINT32_T' (aka 'unsigned int') [-Wformat]\n  ...\"peerinit: %s@%s, id = %lu\", host->user, host->name, host->id);\n                            ~~~                           ^~~~~~~~\n                            %u\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\n6 warnings generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c security.c\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c localhost.c\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c smartshare.c\nsmartshare.c:120:58: warning: format specifies type 'int' but the argument\n      has type 'float' [-Wformat]\n                DEBUG(LOG_INFO, \"smartshare_check: return value = %d\", p);\n                                                                  ~~   ^\n                                                                  %f\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\n1 warning generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c smartmem.c\nsmartmem.c:29:8: warning: unused variable 'str' [-Wunused-variable]\n                char str[256];\n                     ^\nsmartmem.c:28:9: warning: unused variable 'fp' [-Wunused-variable]\n                void *fp;\n                      ^\n2 warnings generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c smartcpu.c\nsmartcpu.c:30:9: warning: unused variable 'AvgLoad1' [-Wunused-variable]\n                float AvgLoad1 = 0, AvgLoad5 = 0, AvgLoad15 = 0;\n                      ^\nsmartcpu.c:30:37: warning: unused variable 'AvgLoad15' [-Wunused-variable]\n                float AvgLoad1 = 0, AvgLoad5 = 0, AvgLoad15 = 0;\n                                                  ^\nsmartcpu.c:29:8: warning: unused variable 'str' [-Wunused-variable]\n                char str[256];\n                     ^\nsmartcpu.c:28:9: warning: unused variable 'fp' [-Wunused-variable]\n                void *fp;\n                      ^\nsmartcpu.c:30:23: warning: unused variable 'AvgLoad5' [-Wunused-variable]\n                float AvgLoad1 = 0, AvgLoad5 = 0, AvgLoad15 = 0;\n                                    ^\n5 warnings generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c connect.c\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -c parser.c\nar rv libpeer.a tcpserver.o udsserver.o tcpsocket.o discover.o announce.o expire.o util.o extern.o peerinit.o security.o localhost.o smartshare.o smartmem.o smartcpu.o connect.o parser.o\nar: creating archive libpeer.a\na - tcpserver.o\na - udsserver.o\na - tcpsocket.o\na - discover.o\na - announce.o\na - expire.o\na - util.o\na - extern.o\na - peerinit.o\na - security.o\na - localhost.o\na - smartshare.o\na - smartmem.o\na - smartcpu.o\na - connect.o\na - parser.o\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -I. -I/Applications/MATLAB_R2015a.app/extern/include -I/Applications/MATLAB_R2015a.app/extern/include -c peerslave.c\npeerslave.c:760:151: warning: format specifies type 'unsigned long' but the\n      argument has type 'unsigned long long' [-Wformat]\n  ...%lu, timreq=%lu)\", ++jobnum, job->host->user, job->host->name, job->job->id, job->job->memreq...\n     ~~~                                                                          ^~~~~~~~~~~~~~~~\n     %llu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\npeerslave.c:760:169: warning: format specifies type 'unsigned long' but the\n      argument has type 'unsigned long long' [-Wformat]\n  ...%lu)\", ++jobnum, job->host->user, job->host->name, job->job->id, job->job->memreq, job->job->timreq);\n     ~~~                                                                                ^~~~~~~~~~~~~~~~\n     %llu\n./peer.h:88:92: note: expanded from macro 'DEBUG'\n  ...(level<=syslog_level) fprintf(stderr, format\"\\n\", ## __VA_ARGS__);}\n                                                          ^~~~~~~~~~~\npeerslave.c:67:13: warning: unused variable 'udsserverThread'\n      [-Wunused-variable]\n                pthread_t udsserverThread;\n                          ^\n3 warnings generated.\ngcc -I. -I/Applications/MATLAB_R2015a.app/extern/include -fPIC -Wall -pthread -DSYSLOG=2 -L. -L/Applications/MATLAB_R2015a.app/bin/maci64 -leng -lmx -L/Applications/MATLAB_R2015a.app/bin/maci64 -leng -lmx -o ../bin/peerslave.maci64 peerslave.o libpeer.a -lm -lpthread -lpeer\nclang: warning: argument unused during compilation: '-pthread'\nUndefined symbols for architecture x86_64:\n  \"_mxDeserialize\", referenced from:\n      _main in peerslave.o\n  \"_mxSerialize\", referenced from:\n      _main in peerslave.o\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: *** [peerslave.maci64] Error 1"
      - +@isprivate: "0"
        commentid: "18364"
        comment_count: "1"
        who:
          +content: r.oostenveld
          +@name: Robert Oostenveld
        bug_when: 2017-02-06 22:12:54 +0100
        thetext: "I have not used peer for a long time. I recall that mxSerialize and mxDeserialize have been removed from recent matlab version, or at least hidden even further away. These mex functions have always been undocumented. \n\nI can confirm the failure, I have it with 2016b on OS X. When compiling with 2012b on OS X there is no compile error.\n\nAh, I found a reference: please see bug 2452. And also see the solution (hack) in src/mxDeserialize_cpp.cpp"
      - +@isprivate: "0"
        commentid: "18368"
        comment_count: "2"
        who:
          +content: n.n.oosterhof
          +@name: nno
        bug_when: 2017-02-07 13:01:27 +0100
        thetext: |-
          >> Compiling the "peer" code using Matlab 2015a on OSX 10.12 gives an error when using the Makefile in src/peer

          > I can confirm the failure, I have it with 2016b on OS X. please see bug 2452. And also see the solution (hack) in src/mxDeserialize_cpp.cpp

          @Robert Oostenveld, thanks for confirming the issue and reference to a possible solution. However, I don't use the peer code myself and this issue does not have sufficient priority for me to try out the solution. Thus, for your information I am not planning to send a PR trying to address it.
      - +@isprivate: "0"
        commentid: "18369"
        comment_count: "3"
        who:
          +content: r.oostenveld
          +@name: Robert Oostenveld
        bug_when: 2017-02-07 13:49:52 +0100
        thetext: "(In reply to nno from comment #2)\n\nok, then this won't be fixed. \nIt is still good to have the information here for future reference."
      - +@isprivate: "0"
        commentid: "18371"
        comment_count: "4"
        who:
          +content: n.n.oosterhof
          +@name: nno
        bug_when: 2017-02-07 15:36:25 +0100
        thetext: "(In reply to Robert Oostenveld from comment #3)\n\n> ok, then this won't be fixed. \n> It is still good to have the information here for future reference.\n\nAbsolutely. It may also be useful for others who encounter the same issue in the future. They may find this post to learn that is has been reported and what its current status is."
      - +@isprivate: "0"
        commentid: "20290"
        comment_count: "5"
        who:
          +content: r.oostenveld
          +@name: Robert Oostenveld
        bug_when: 2019-08-10 12:35:27 +0200
        thetext: "This closes a whole series of bugs that have been resolved (either FIXED/WONTFIX/INVALID) for quite some time. \n\nIf you disagree, please file a new issue on https://github.com/fieldtrip/fieldtrip/issues."
      - +@isprivate: "0"
        commentid: "20490"
        comment_count: "6"
        who:
          +content: r.oostenveld
          +@name: Robert Oostenveld
        bug_when: 2019-08-10 12:41:40 +0200
        thetext: "This closes a whole series of bugs that have been resolved (either FIXED/WONTFIX/INVALID) for quite some time. \n\nIf you disagree, please file a new issue on https://github.com/fieldtrip/fieldtrip/issues."
